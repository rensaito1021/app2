<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <!-- ビューポートの設定：モバイルデバイスでの表示を最適化 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シンプルTODO</title>
    <style>
        /* フォームの上下に余白を追加 */
        .todo-form {
            margin: 1rem 0;
        }

        /* 完了したTODOのスタイル：取り消し線と薄い色 */
        .completed {
            text-decoration: line-through;
            color: gray;
        }
    </style>
</head>

<body>
    <h1>音楽再生</h1>

    <!-- 音楽ファイルのアップロードフォーム -->
    <form id="uploadForm">
        <input type="file" id="musicFile" accept="audio/*" required />
        <button type="submit">音楽をアップロード</button>
    </form>

    <!-- 音楽リストを表示する場所 -->
    <h2>再生リスト</h2>
    <ul id="musicList"></ul>

    <!-- 音楽再生用のプレイヤー -->
    <audio id="audioPlayer" controls style="display:none;"></audio>

    <script>
        const API_URL = '/music'; // 音楽APIのベースURL

        // 音楽リストを読み込んで表示する関数
        async function loadMusic() {
            const response = await fetch(`${API_URL}`);
            const musicList = await response.json();
            const musicListElement = document.getElementById('musicList');
            musicListElement.innerHTML = musicList.map(music => `
                <li>
                    <span class="${music.completed ? 'completed' : ''}">${music.title}</span>
                    <button onclick="playMusic(${music.id})">再生</button>
                    <button onclick="deleteMusic(${music.id})">削除</button>
                </li>
            `).join('');
        }

        // 音楽アップロードフォームの送信イベント
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const fileInput = document.getElementById('musicFile');
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            // 音楽ファイルをサーバーにアップロード
            await fetch(`${API_URL}/upload`, {
                method: 'POST',
                body: formData,
            });

            // アップロード後に音楽リストを再読み込み
            loadMusic();
        });

        // 音楽を再生する関数
        function playMusic(id) {
            fetch(`${API_URL}/${id}`)
                .then(response => response.json())
                .then(music => {
                    const audioPlayer = document.getElementById('audioPlayer');
                    audioPlayer.src = `${API_URL}/uploads/${music.filename}`;
                    audioPlayer.style.display = 'block';
                    audioPlayer.play();
                });
        }

        // 音楽を削除する関数
        async function deleteMusic(id) {
            await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
            loadMusic();  // 削除後にリストを再読み込み
        }

        // ページ読み込み完了時に音楽リストを表示
        document.addEventListener('DOMContentLoaded', () => {
            loadMusic();
        });
    </script>
</body>

</html>
